webpackJsonp([5],{"7WUx":function(e,t){},MjTu:function(e,t){},XCfr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("aA9S"),n=r.n(o),s=r("BtRb"),a={name:"roleAdd",props:{tree:{type:Array},isVisible:!1},data:function(){var e=this;return{isShow:!1,treeCheck:{checkedKeys:"",checkedId:"",data:{}},role:{name:"",authors:[]},defaultProps:{children:"children",label:"name"},rules:{name:[{required:!0,message:"角色名必填",trigger:"blur"}],authors:[{required:!0,validator:function(t,r,o){e.role.authors.length>0?o():o(new Error("请选择权限"))},message:"权限必选",trigger:"blur"}]}}},watch:{isVisible:function(e){this.isShow=e}},methods:{close:function(){this.role={name:"",authors:[]},this.treeCheck={checkedKeys:"",checkedId:"",data:{}},this.$emit("event",{cmd:"closeAdd"})},submitForm:function(e){var t=this;this.$refs[e].validate(function(r){if(!r)return!1;if(t.role.authors&&t.role.authors.length>0){var o=[];t.role.authors.forEach(function(e){o.push(e.id)}),t.role.resourceIds=o}Object(s.b)(t.role).then(function(r){0==r.code?(t.$message.success("添加成功"),t.resetForm(e),t.$emit("event",{cmd:"addSuccess"})):t.$message.error(r.message)})})},resetForm:function(e){this.$refs[e].resetFields()},selectionTree:function(){var e=this.$refs.authorTree.getCheckedNodes(!1,!0);this.role.authors=e}}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-drawer",{attrs:{title:"添加角色",visible:e.isShow,size:"60%",wrapperClosable:!1,"destroy-on-close":""},on:{"update:visible":function(t){e.isShow=t},close:e.close}},[r("div",[r("el-form",{ref:"role",attrs:{rules:e.rules,model:e.role,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"权限",prop:"authors"}},[r("el-tree",{ref:"authorTree",attrs:{data:e.tree,"node-key":"id","show-checkbox":"",props:e.defaultProps},on:{check:function(t){return e.selectionTree()}}})],1)],1)],1),e._v(" "),r("span",{staticClass:"drawer-footer"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitForm("role")}}},[e._v("提交")])],1)])},staticRenderFns:[]};var l=r("C7Lr")(a,i,!1,function(e){r("7WUx")},null,null).exports,c={name:"menuEdit",props:{tree:{type:Array},role:{type:Object},isVisible:!1},watch:{isVisible:function(e){this.isShow=e}},data:function(){var e=this;return{treeCheck:{checkedKeys:"",checkedId:"",data:{}},isShow:!1,defaultProps:{children:"children",label:"name"},rules:{name:[{required:!0,message:"角色名必填",trigger:"blur"}],authors:[{required:!0,validator:function(t,r,o){e.role.authors.length>0?o():o(new Error("请选择权限"))},message:"权限必选",trigger:"blur"}]}}},methods:{open:function(){this.setCheckedTree()},close:function(){this.$emit("event",{cmd:"closeEdit"})},submitForm:function(e){var t=this;if(t.role.authors&&t.role.authors.length>0){var r=[];t.role.authors.forEach(function(e){r.push(e)}),t.role.resourceIds=r}this.$refs[e].validate(function(e){e&&Object(s.j)(t.role).then(function(e){0==e.code?(t.$message.success("修改成功"),t.$emit("event",{cmd:"editSuccess"})):t.$message.error(e.message)})})},selectionTree:function(){var e=[];this.$refs.editTree.getCheckedNodes(!1,!0).forEach(function(t){e.push(t.id)}),this.role.authors=e},setCheckedTree:function(){var e=this;e.role.resourceIds&&e.role.resourceIds.length>0&&e.role.resourceIds.forEach(function(t,r){e.$refs.editTree.setChecked(t,!0),e.selectionTree()})}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-drawer",{attrs:{title:"编辑角色",visible:e.isShow,size:"60%",wrapperClosable:!1,"destroy-on-close":""},on:{"update:visible":function(t){e.isShow=t},close:e.close,opened:e.open}},[r("div",[r("el-form",{ref:"role",attrs:{rules:e.rules,model:e.role,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"权限",prop:"authors"}},[r("el-tree",{ref:"editTree",attrs:{data:e.tree,"node-key":"id","show-checkbox":"",props:e.defaultProps},on:{check:function(t){return e.selectionTree()}}})],1)],1)],1),e._v(" "),r("span",{staticClass:"drawer-footer"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitForm("role")}}},[e._v("提交")])],1)])},staticRenderFns:[]};var d=r("C7Lr")(c,u,!1,function(e){r("gCzY")},null,null).exports,h={name:"roleShow",props:{tree:{type:Array},role:{type:Object},isVisible:!1},data:function(){return{isShow:!1,treeCheck:{checkedKeys:"",checkedId:"",data:{}},defaultProps:{children:"children",label:"name"}}},watch:{isVisible:function(e){this.isShow=e}},methods:{close:function(){this.$emit("event",{cmd:"closeShow"})},deleteRole:function(e){var t=this;t.$confirm("是否确认删除,将会清除所有用户下的当前角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.g)(t.role.id).then(function(e){0==e.code?(t.$message.success("删除成功"),t.$emit("event",{cmd:"delete"})):t.$message.error(e.message)})})},toEdit:function(){this.$emit("event",{cmd:"edit"})},setCheckedTree:function(){var e=this;e.role.resourceIds&&e.role.resourceIds.length>0&&e.role.resourceIds.forEach(function(t,r){e.$refs.authorTree.setChecked(t,!0)})},open:function(){this.setCheckedTree()}}},f={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-drawer",{attrs:{title:"查看角色",visible:e.isShow,size:"60%",wrapperClosable:!1,"destroy-on-close":""},on:{"update:visible":function(t){e.isShow=t},close:e.close,opened:e.open}},[r("div",[r("el-form",{attrs:{"label-width":"120px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[e._v("\n          "+e._s(e.role.name)+"\n        ")]),e._v(" "),r("el-form-item",{attrs:{label:"权限",prop:"authors"}},[r("el-tree",{ref:"authorTree",attrs:{data:e.tree,"node-key":"id","show-checkbox":"",props:e.defaultProps}})],1)],1)],1),e._v(" "),r("span",{staticClass:"drawer-footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.toEdit}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteRole()}}},[e._v("删除")])],1)])},staticRenderFns:[]};var m={name:"roles",components:{add:l,edit:d,show:r("C7Lr")(h,f,!1,function(e){r("MjTu")},"data-v-02af6571",null).exports},data:function(){return{query:{},columns:[{prop:"name",label:"角色名称",width:"200",align:"center"},{prop:"createdAt",label:"创建时间",align:"center",formatter:function(e,t,r){return new $day(r).format("YYYY-MM-DD HH:mm:ss")}}],addShow:!1,openShow:!1,editShow:!1,tableData:[],page:{pageNo:1,pageSize:10,total:0},tree:[],currentRow:{}}},mounted:function(){this.queryData()},methods:{toAdd:function(){var e=this;Object(s.l)().then(function(t){e.tree=t.data,e.addShow=!0})},toShow:function(e){var t=this;Object(s.m)(e.id).then(function(e){t.currentRow=e.data,Object(s.l)().then(function(e){t.tree=e.data,t.openShow=!0})})},toEdit:function(e){var t=this;Object(s.m)(e.id).then(function(e){t.currentRow=e.data,Object(s.l)().then(function(e){t.tree=e.data,t.editShow=!0})})},deleteRole:function(e){var t=this;t.$confirm("是否确认删除,将会清除所有用户下的当前角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.g)(e.id).then(function(e){0==e.code?(t.$message.success("删除成功"),t.queryData()):t.$message.error(e.message)})})},queryData:function(){var e=this;Object(s.n)(n()(e.query,e.page)).then(function(t){0==t.code?(e.tableData=t.data.data,e.page.total=t.data.totalRows):e.$message.error("获取数据失败")})},onEvent:function(e){"edit"==e.cmd?(this.editShow=!0,this.openShow=!1):"delete"==e.cmd?(this.openShow=!1,this.queryData()):"closeAdd"==e.cmd?this.addShow=!1:"closeShow"==e.cmd?this.openShow=!1:"closeEdit"==e.cmd?this.editShow=!1:"addSuccess"==e.cmd?(this.addShow=!1,this.queryData()):"editSuccess"==e.cmd&&(this.editShow=!1,this.queryData())},handleSizeChange:function(e){this.page.pageSize=e,this.queryData()},handleCurrentChange:function(e){this.page.pageNo=e,this.queryData()},editTableData:function(e){this.openOperation(e)}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"queryForm",staticClass:"query-form",attrs:{inline:!0,model:e.query}},[r("el-form-item",{attrs:{label:"角色名"}},[r("el-input",{attrs:{clearable:"",placeholder:"角色名"},model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}})],1),e._v(" "),r("el-form-item",{staticStyle:{float:"right"}},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.queryData()}}},[e._v("查询")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.toAdd()}}},[e._v("新增")])],1)],1),e._v(" "),r("common-table",{attrs:{columns:e.columns,data:e.tableData,pager:e.page},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}},[r("el-table-column",{attrs:{slot:"table_operation",align:"center",label:"操作",width:"180",resizable:!1},slot:"table_operation",scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"text"},on:{click:function(r){return e.toShow(t.row)}}},[e._v("查看")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"text"},on:{click:function(r){return e.toEdit(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"text"},on:{click:function(r){return e.deleteRole(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("add",{attrs:{tree:e.tree,"is-visible":e.addShow},on:{event:e.onEvent}}),e._v(" "),r("edit",{attrs:{"is-visible":e.editShow,tree:e.tree,role:e.currentRow},on:{event:e.onEvent}}),e._v(" "),r("show",{attrs:{role:e.currentRow,tree:e.tree,"is-visible":e.openShow},on:{event:e.onEvent}})],1)},staticRenderFns:[]},v=r("C7Lr")(m,p,!1,null,null,null);t.default=v.exports},gCzY:function(e,t){}});
//# sourceMappingURL=5.2998aa29bb0299c11b3e.js.map